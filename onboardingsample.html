<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Infinite Hunters – Employee Onboarding</title>

<style>
body {
    font-family: "Times New Roman", serif;
    background:#f2f4f7;
    padding:20px;
    font-size: 15px;
    color: navy;
}
.container {
    background:#fff;
    padding:25px 30px;
    border-radius:8px;
    max-width:1100px;
    margin:auto;
    border:2px solid navy;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
h2 {
    text-align:center;
    background: navy;
    color:#fff;
    padding:15px;
    font-size: 20px;
    border-radius:4px;
    margin-bottom:25px;
}
h3 {
    border-bottom:2px solid navy;
    padding-bottom:6px;
    font-size: 17px;
    color: navy;
    margin-bottom:12px;
}
.section {
    margin-bottom:25px;
}
label {
    font-weight:bold;
    display:block;
    margin-top:10px;
    font-size: 15px;
}
input, select {
    width:100%;
    padding:8px 9px;
    margin-top:4px;
    font-family: "Times New Roman", serif;
    font-size: 15px;
    border:1px solid navy;
    border-radius:4px;
    box-sizing:border-box;
}
.row {
    display:flex;
    gap:8px;
    align-items:center;
}
.add-btn {
    padding:7px 14px;
    background: navy;
    color:#fff;
    border:none;
    cursor:pointer;
    font-size: 15px;
    border-radius:4px;
}
.hidden {
    display:none;
}
.submit-btn {
    display:block;
    margin:20px auto 0;
    background: navy;
    color:#fff;
    padding:12px 40px;
    border:none;
    cursor:pointer;
    font-size: 16px;
    border-radius:6px;
    font-weight:bold;
}
.submit-btn:hover { background:navy; }
.grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:15px 20px; }
</style>
</head>

<body>

<div class="container">
<h2>Infinite Hunters – Employee Onboarding (Admin)</h2>

<!-- Updated form with action, method, enctype -->
<form action="http://localhost:3000/submit-onboarding" method="POST" enctype="multipart/form-data">

<!-- SECTION 1: Basic Details -->
<div class="section">
<h3>Basic Details</h3>
<div class="grid-2">
<div>
<label>Email *</label>
<input type="email" name="email" required>
</div>
<div>
<label>Date of Upload *</label>
<input type="date" name="dateOfUpload" required>
</div>
</div>

<label>Sourced By *</label>
<select name="sourcedBy" required>
    <option value="">Select</option>
    <option>Recruiter</option>
    <option>Freelancer</option>
</select>
</div>

<!-- SECTION 2: Recruiter Details -->
<div class="section">
<h3>Recruiter Details</h3>
<label>Recruiter *</label>
<div class="row">
    <select id="recruiterSelect" name="recruiter" required>
        <option value="">Select</option>
        <option>Swiggy</option>
        <option>Zepto</option>
    </select>
    <button type="button" class="add-btn" onclick="showInput('recruiterInput')">+</button>
</div>
<input id="recruiterInput" class="hidden" placeholder="Add Recruiter"
onblur="addToDropdown('recruiterSelect','recruiterInput')">
</div>

<!-- SECTION 3: Client Details -->
<div class="section">
<h3>Client Details</h3>
<label>Client *</label>
<div class="row">
    <select id="clientSelect" name="client" required>
        <option value="">Select</option>
        <option>Swiggy - Instamart</option>
        <option>Zepto - Kirana Kart</option>
    </select>
    <button type="button" class="add-btn" onclick="showInput('clientInput')">+</button>
</div>
<input id="clientInput" class="hidden" placeholder="Add Client"
onblur="addToDropdown('clientSelect','clientInput')">
</div>

<!-- SECTION 4: Location -->
<div class="section">
<h3>Location</h3>
<div class="grid-2">
<div>
<label>State *</label>
<div class="row">
    <select id="stateSelect" name="state" required>
        <option value="">Select</option>
        <option>Tamil Nadu</option>
        <option>Telangana</option>
    </select>
    <button type="button" class="add-btn" onclick="showInput('stateInput')">+</button>
</div>
<input id="stateInput" class="hidden" placeholder="Add State"
onblur="addToDropdown('stateSelect','stateInput')">
</div>

<div>
<label>City *</label>
<div class="row">
    <select id="citySelect" name="city" required>
        <option value="">Select</option>
        <option>Chennai</option>
        <option>Hyderabad</option>
    </select>
    <button type="button" class="add-btn" onclick="showInput('cityInput')">+</button>
</div>
<input id="cityInput" class="hidden" placeholder="Add City"
onblur="addToDropdown('citySelect','cityInput')">
</div>
</div>
</div>

<!-- SECTION 5: Employee Details -->
<div class="section">
<h3>Employee Details</h3>
<div class="grid-2">
<div>
<label>Working Location *</label>
<input type="text" name="workingLocation" required>
</div>
<div>
<label>Payroll *</label>
<select name="payroll" required>
    <option>Contractual Worker</option>
    <option>NAPS</option>
</select>
</div>
</div>

<label>Designation *</label>
<select name="designation" required>
    <option>Picker</option>
    <option>Packer</option>
    <option>Loader</option>
    <option>Delivery Executive</option>
    <option>Shift Incharge</option>
</select>

<div class="grid-2">
<div>
<label>Employee Name (As per Aadhar) *</label>
<input type="text" name="employeeName" required>
</div>
<div>
<label>Mobile *</label>
<input type="tel" name="mobile" required>
</div>
</div>

<div class="grid-2">
<div>
<label>Emergency Mobile *</label>
<input type="tel" name="emergencyMobile" required>
</div>
<div>
<label>Alternate Email (Optional)</label>
<input type="email" name="alternateEmail">
</div>
</div>

<div class="grid-2">
<div>
<label>DOB *</label>
<input type="date" name="dob" required>
</div>
<div>
<label>Gender *</label>
<select name="gender" required>
    <option>Male</option>
    <option>Female</option>
</select>
</div>
</div>

<div class="grid-2">
<div>
<label>Marital Status *</label>
<select name="maritalStatus" required>
    <option>Married</option>
    <option>Unmarried</option>
</select>
</div>
<div>
<label>Date of Joining *</label>
<input type="date" name="doj" required>
</div>
</div>

<label>Father / Husband Name *</label>
<input type="text" name="fatherName" required>

<label>Permanent Address *</label>
<input type="text" name="permanentAddress" required>

<label>Present Address</label>
<input type="text" name="presentAddress">
</div>

<!-- SECTION 6: Attachments -->
<div class="section">
<h3>Attachments</h3>
<div class="grid-2">
<div>
<label>Aadhar Number *</label>
<input type="text" name="aadharNumber" required>
</div>
<div>
<label>Bank Name *</label>
<input type="text" name="bankName" required>
</div>
</div>

<div class="grid-2">
<div>
<label>Bank Account Number *</label>
<input type="text" name="accountNumber" required>
</div>
<div>
<label>IFSC Code *</label>
<input type="text" name="ifsc" required>
</div>
</div>

<label>Passport Photo *</label>
<input type="file" name="passportPhoto" required>

<label>Passbook / Cheque Leaf *</label>
<input type="file" name="passbook" required>
</div>

<button type="submit" class="submit-btn">Submit & Onboard</button>
</form>
</div>
<script>
async function sendOfferLetterEmail(employeeName, employeeEmail) {
    const response = await fetch("http://localhost:3000/send-offer-letter", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            employeeName: employeeName,
            employeeEmail: employeeEmail
        })
    });

    return response.ok;
}

document.querySelector("form").addEventListener("submit", function (e) {
    e.preventDefault();
    const form = this;

    function getInput(labelText) {
        const labels = document.querySelectorAll("label");
        for (let lbl of labels) {
            if (lbl.textContent.trim() === labelText) {
                return lbl.nextElementSibling;
            }
        }
        return null;
    }

    // 1️⃣ Mandatory validation
    const requiredFields = form.querySelectorAll("input[required], select[required]");
    for (let field of requiredFields) {
        if (field.type === "file") {
            if (!field.files.length) {
                alert("Please upload " + field.previousElementSibling.textContent);
                return;
            }
        } else if (!field.value.trim()) {
            alert("Please fill " + field.previousElementSibling.textContent);
            return;
        }
    }

    // 2️⃣ Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const emails = form.querySelectorAll('input[type="email"]');
    for (let email of emails) {
        if (email.value && !emailRegex.test(email.value.trim())) {
            alert("Invalid email format");
            return;
        }
    }

    // 3️⃣ Mobile validation
    const mobileRegex = /^[6-9]\d{9}$/;
    const mobile = getInput("Mobile *");
    const emergency = getInput("Emergency Mobile *");

    if (!mobileRegex.test(mobile.value)) {
        alert("Invalid mobile number");
        return;
    }
    if (!mobileRegex.test(emergency.value)) {
        alert("Invalid emergency mobile");
        return;
    }
    if (mobile.value === emergency.value) {
        alert("Emergency mobile cannot be same as mobile");
        return;
    }

    // 4️⃣ Aadhar validation
    const aadhar = getInput("Aadhar Number *");
    if (!/^\d{12}$/.test(aadhar.value)) {
        alert("Aadhar must be 12 digits");
        return;
    }

    // 5️⃣ Bank & IFSC validation
    const bankName = getInput("Bank Name *").value.trim().toUpperCase();
    const ifscInput = getInput("IFSC Code *");
    ifscInput.value = ifscInput.value.toUpperCase();

    const bankIfscMap = {
        "STATE BANK OF INDIA": "SBIN",
        "HDFC BANK": "HDFC",
        "ICICI BANK": "ICIC",
        "AXIS BANK": "UTIB",
        "KOTAK MAHINDRA BANK": "KKBK",
        "PUNJAB NATIONAL BANK": "PUNB",
        "CANARA BANK": "CNRB",
        "BANK OF BARODA": "BARB"
    };

    let matched = false;
    for (let bank in bankIfscMap) {
        if (bankName.includes(bank)) {
            if (!ifscInput.value.startsWith(bankIfscMap[bank])) {
                alert("Bank name and IFSC do not match");
                return;
            }
            matched = true;
        }
    }

    if (!matched) {
        alert("Invalid bank name");
        return;
    }

    // 6️⃣ DOB < DOJ
    const dob = new Date(getInput("DOB *").value);
    const doj = new Date(getInput("Date of Joining *").value);
    if (dob >= doj) {
        alert("DOB must be before DOJ");
        return;
    }

    // ===============================
    // ✅ FINAL STEP: EMAIL + SUBMIT
    // ===============================
    const employeeName = form.querySelector('input[name="employeeName"]').value;
    const employeeEmail = form.querySelector('input[name="email"]').value;

    sendOfferLetterEmail(employeeName, employeeEmail)
        .then(success => {
            if (success) {
                alert("Offer letter sent successfully. Onboarding completed.");
                form.submit(); // ✅ ONLY submit here
            } else {
                alert("Email failed. Onboarding not submitted.");
            }
        });
});
</script>



</body>
</html>